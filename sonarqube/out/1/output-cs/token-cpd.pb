Â
3D:\C#handson\WebAPI-2\ApiModel\ClassRoomApiModel.cs
	namespace 	
WebAPI_2
 
. 
ApiModel 
{ 
public 

class 
ClassRoomApiModel "
{ 
public 
int 
ID 
{ 
get 
; 
set  
;  !
}" #
public 
string 
? 
	ClassName  
{! "
get# &
;& '
set( +
;+ ,
}- .
} 
}		 —
=D:\C#handson\WebAPI-2\ApiModel\TeacherAndClassRoomApiModel.cs
	namespace 	
WebAPI_2
 
. 
ApiModel 
{ 
public 

class '
TeacherAndClassRoomApiModel ,
{ 
public 
TeacherApiModel 
Teacher &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
List 
< 
ClassRoomApiModel %
>% &
ClassRoomList' 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
} 
}		 
1D:\C#handson\WebAPI-2\ApiModel\TeacherApiModel.cs
	namespace 	
WebAPI_2
 
. 
ApiModel 
{ 
public 

class 
TeacherApiModel  
{ 
public 
int 
ID 
{ 
get 
; 
set  
;  !
}" #
public 
string 
? 
Name 
{ 
get !
;! "
set# &
;& '
}( )
public		 
string		 
?		 
Address		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
public 
string 
? 
EmailId 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ¾:
7D:\C#handson\WebAPI-2\Controllers\StudentsController.cs
	namespace 	
WebAPI_2
 
. 
Controllers 
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
StudentsController #
:$ %
ControllerBase& 4
{ 
private 
readonly 
ApiDbContext %
_context& .
;. /
public 
StudentsController !
(! "
ApiDbContext" .
context/ 6
)6 7
{ 	
_context 
= 
context 
; 
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
ActionResult &
<& '
IEnumerable' 2
<2 3
Student3 :
>: ;
>; <
>< =
GetStudents> I
(I J
)J K
{ 	
if
 
( 
_context 
. 
Students 
==  "
null# '
)' (
{
 
return 
NotFound 
( 
) 
;  
}
 
return   
await   
_context   !
.  ! "
Students  " *
.  * +
ToListAsync  + 6
(  6 7
)  7 8
;  8 9
}!! 	
[$$ 	
HttpGet$$	 
($$ 
$str$$ 
)$$ 
]$$ 
public%% 
async%% 
Task%% 
<%% 
ActionResult%% &
<%%& '
Student%%' .
>%%. /
>%%/ 0

GetStudent%%1 ;
(%%; <
int%%< ?
id%%@ B
)%%B C
{&& 	
if''
 
('' 
_context'' 
.'' 
Students'' 
==''  "
null''# '
)''' (
{((
 
return)) 
NotFound)) 
()) 
))) 
;))  
}**
 
var++ 
student++ 
=++ 
await++ 
_context++  (
.++( )
Students++) 1
.++1 2
	FindAsync++2 ;
(++; <
id++< >
)++> ?
;++? @
if-- 
(-- 
student-- 
==-- 
null-- 
)--  
{.. 
return// 
NotFound// 
(//  
)//  !
;//! "
}00 
return22 
student22 
;22 
}33 	
[77 	
HttpPut77	 
(77 
$str77 
)77 
]77 
public88 
async88 
Task88 
<88 
IActionResult88 '
>88' (

PutStudent88) 3
(883 4
int884 7
id888 :
,88: ;
Student88< C
student88D K
)88K L
{99 	
if:: 
(:: 
id:: 
!=:: 
student:: 
.:: 
ID::  
)::  !
{;; 
return<< 

BadRequest<< !
(<<! "
)<<" #
;<<# $
}== 
_context?? 
.?? 
Entry?? 
(?? 
student?? "
)??" #
.??# $
State??$ )
=??* +
EntityState??, 7
.??7 8
Modified??8 @
;??@ A
tryAA 
{BB 
awaitCC 
_contextCC 
.CC 
SaveChangesAsyncCC /
(CC/ 0
)CC0 1
;CC1 2
}DD 
catchEE 
(EE (
DbUpdateConcurrencyExceptionEE /
)EE/ 0
{FF 
ifGG 
(GG 
!GG 
StudentExistsGG "
(GG" #
idGG# %
)GG% &
)GG& '
{HH 
returnII 
NotFoundII #
(II# $
)II$ %
;II% &
}JJ 
elseKK 
{LL 
throwMM 
;MM 
}NN 
}OO 
returnQQ 
	NoContentQQ 
(QQ 
)QQ 
;QQ 
}RR 	
[VV 	
HttpPostVV	 
]VV 
publicWW 
asyncWW 
TaskWW 
<WW 
ActionResultWW &
<WW& '
StudentWW' .
>WW. /
>WW/ 0
PostStudentWW1 <
(WW< =
StudentWW= D
studentWWE L
)WWL M
{XX 	
ifYY
 
(YY 
_contextYY 
.YY 
StudentsYY 
==YY  "
nullYY# '
)YY' (
{ZZ
 
return[[ 
Problem[[ 
([[ 
$str[[ K
)[[K L
;[[L M
}\\
 
_context]] 
.]] 
Students]] 
.]] 
Add]] !
(]]! "
student]]" )
)]]) *
;]]* +
await^^ 
_context^^ 
.^^ 
SaveChangesAsync^^ +
(^^+ ,
)^^, -
;^^- .
return`` 
CreatedAtAction`` "
(``" #
$str``# /
,``/ 0
new``1 4
{``5 6
id``7 9
=``: ;
student``< C
.``C D
ID``D F
}``G H
,``H I
student``J Q
)``Q R
;``R S
}aa 	
[dd 	

HttpDeletedd	 
(dd 
$strdd 
)dd 
]dd 
publicee 
asyncee 
Taskee 
<ee 
IActionResultee '
>ee' (
DeleteStudentee) 6
(ee6 7
intee7 :
idee; =
)ee= >
{ff 	
ifgg 
(gg 
_contextgg 
.gg 
Studentsgg !
==gg" $
nullgg% )
)gg) *
{hh 
returnii 
NotFoundii 
(ii  
)ii  !
;ii! "
}jj 
varkk 
studentkk 
=kk 
awaitkk 
_contextkk  (
.kk( )
Studentskk) 1
.kk1 2
	FindAsynckk2 ;
(kk; <
idkk< >
)kk> ?
;kk? @
ifll 
(ll 
studentll 
==ll 
nullll 
)ll  
{mm 
returnnn 
NotFoundnn 
(nn  
)nn  !
;nn! "
}oo 
_contextqq 
.qq 
Studentsqq 
.qq 
Removeqq $
(qq$ %
studentqq% ,
)qq, -
;qq- .
awaitrr 
_contextrr 
.rr 
SaveChangesAsyncrr +
(rr+ ,
)rr, -
;rr- .
returntt 
	NoContenttt 
(tt 
)tt 
;tt 
}uu 	
privateww 
boolww 
StudentExistsww "
(ww" #
intww# &
idww' )
)ww) *
{xx 	
returnyy 
(yy 
_contextyy 
.yy 
Studentsyy %
?yy% &
.yy& '
Anyyy' *
(yy* +
eyy+ ,
=>yy- /
eyy0 1
.yy1 2
IDyy2 4
==yy5 7
idyy8 :
)yy: ;
)yy; <
.yy< =
GetValueOrDefaultyy= N
(yyN O
)yyO P
;yyP Q
}zz 	
}{{ 
}|| ¾f
7D:\C#handson\WebAPI-2\Controllers\TeachersController.cs
	namespace 	
WebAPI_2
 
. 
Controllers 
{		 
[

 
Route

 

(


 
$str

 
)

 
]

 
[ 
ApiController 
] 
public 

class 
TeachersController #
:$ %
ControllerBase& 4
{ 
private 
readonly 
ApiDbContext %
_context& .
;. /
private 
readonly 
IMapper  
_mapper! (
;( )
public 
TeachersController !
(! "
ApiDbContext" .
context/ 6
,6 7
IMapper8 ?
mapper@ F
)F G
{ 	
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' (

GetTeacher) 3
(3 4
)4 5
{ 	
if 
( 
_context 
. 
Teachers !
==" $
null% )
)) *
{ 
return 
NotFound 
(  
)  !
;! "
} 
var   
obj   
=   
_context   
.   
Teachers   '
.  ' (
Include  ( /
(  / 0
t  0 1
=>  2 4
t  5 6
.  6 7
ClassRoomList  7 D
)  D E
.  E F
ToList  F L
(  L M
)  M N
;  N O
var!! 
ob!! 
=!! 
_mapper!! 
.!! 
Map!!  
<!!  !
List!!! %
<!!% &
Teacher!!& -
>!!- .
>!!. /
(!!/ 0
obj!!0 3
)!!3 4
;!!4 5
return## 
Ok## 
(## 
ob## 
)## 
;## 
})) 	
[,, 	
HttpGet,,	 
(,, 
$str,, 
),, 
],, 
public--	 
async-- 
Task-- 
<-- 
ActionResult-- '
<--' (
Teacher--( /
>--/ 0
>--0 1
GetTeachers--2 =
(--= >
int--> A
id--B D
)--D E
{.. 	
if// 
(// 
_context// 
.// 
Teachers// !
==//" $
null//% )
)//) *
{00 
return11 
NotFound11 
(11  
)11  !
;11! "
}22 
var33 
teacher33 
=33 
_context33 "
.33" #
Teachers33# +
.33+ ,
Where33, 1
(331 2
t332 3
=>334 6
t337 8
.338 9
ID339 ;
==33< >
id33? A
)33A B
.33B C
Include33C J
(33J K
cls33K N
=>33O Q
cls33R U
.33U V
ClassRoomList33V c
)33c d
.33d e
FirstOrDefault33e s
(33s t
)33t u
;33u v
if55 
(55 
teacher55 
==55 
null55 
)55  
{66 
return77 
NotFound77 
(77  
)77  !
;77! "
}88 
else99 
{:: 
return;; 
_mapper;; 
.;; 
Map;; "
<;;" #
Teacher;;# *
>;;* +
(;;+ ,
teacher;;, 3
);;3 4
;;;4 5
}<< 
}>> 	
[BB 	
HttpPutBB	 
(BB 
$strBB 
)BB 
]BB 
publicCC 
asyncCC 
TaskCC 
<CC 
IActionResultCC '
>CC' (

PutTeacherCC) 3
(CC3 4
intCC4 7
idCC8 :
,CC: ;'
TeacherAndClassRoomApiModelCC< W'
teacherAndClassRoomApiModelCCX s
)CCs t
{DD 	
varFF 
objFF 
=FF 
_mapperFF 
.FF 
MapFF !
<FF! "
TeacherFF" )
>FF) *
(FF* +'
teacherAndClassRoomApiModelFF+ F
.FFF G
TeacherFFG N
)FFN O
;FFO P
varGG 
listGG 
=GG 
_mapperGG 
.GG 
MapGG "
<GG" #
ListGG# '
<GG' (
	ClassRoomGG( 1
>GG1 2
>GG2 3
(GG3 4'
teacherAndClassRoomApiModelGG4 O
.GGO P
ClassRoomListGGP ]
)GG] ^
;GG^ _
varHH 
obHH 
=HH 
_contextHH 
.HH 
TeachersHH &
.HH& '
WhereHH' ,
(HH, -
tHH- .
=>HH/ 1
tHH2 3
.HH3 4
IDHH4 6
==HH7 9
idHH: <
)HH< =
.HH= >
IncludeHH> E
(HHE F
cHHF G
=>HHH J
cHHK L
.HHL M
ClassRoomListHHM Z
)HHZ [
.HH[ \
FirstOrDefaultHH\ j
(HHj k
)HHk l
;HHl m
ifKK 
(KK 
idKK 
!=KK 
obKK 
.KK 
IDKK 
)KK 
{LL 
returnMM 

BadRequestMM !
(MM! "
)MM" #
;MM# $
}NN 
obOO 
.OO 
AddressOO 
=OO 
objOO 
.OO 
AddressOO $
;OO$ %
obPP 
.PP 
NamePP 
=PP 
objPP 
.PP 
NamePP 
;PP 
obQQ 
.QQ 
EmailIdQQ 
=QQ 
objQQ 
.QQ 
EmailIdQQ $
;QQ$ %
obSS 
.SS 
ClassRoomListSS 
=SS 
listSS #
;SS# $
_contextUU 
.UU 
UpdateUU 
(UU 
obUU 
)UU 
;UU  
tryXX 
{YY 
awaitZZ 
_contextZZ 
.ZZ 
SaveChangesAsyncZZ /
(ZZ/ 0
)ZZ0 1
;ZZ1 2
}[[ 
catch\\ 
(\\ (
DbUpdateConcurrencyException\\ /
)\\/ 0
{]] 
if^^ 
(^^ 
!^^ 
TeacherExists^^ "
(^^" #
id^^# %
)^^% &
)^^& '
{__ 
return`` 
NotFound`` #
(``# $
)``$ %
;``% &
}aa 
elsebb 
{cc 
throwdd 
;dd 
}ee 
}ff 
returnhh 
	NoContenthh 
(hh 
)hh 
;hh 
}ii 	
[mm 	
HttpPostmm	 
]mm 
publicnn 
asyncnn 
Tasknn 
<nn 
ActionResultnn &
<nn& '
Teachernn' .
>nn. /
>nn/ 0
PostTeachernn1 <
(nn< ='
TeacherAndClassRoomApiModelnn= X'
teacherAndClassRoomApiModelnnY t
)nnt u
{oo 	
ifpp 
(pp 
_contextpp 
.pp 
Teacherspp !
==pp" $
nullpp% )
)pp) *
{qq 
returnrr 
Problemrr 
(rr 
$strrr M
)rrM N
;rrN O
}ss 
var|| 
obj|| 
=|| 
_mapper|| 
.|| 
Map|| !
<||! "
Teacher||" )
>||) *
(||* +'
teacherAndClassRoomApiModel||+ F
.||F G
Teacher||G N
)||N O
;||O P
var~~ 
classRoomList~~ 
=~~ 
_mapper~~  '
.~~' (
Map~~( +
<~~+ ,
List~~, 0
<~~0 1
	ClassRoom~~1 :
>~~: ;
>~~; <
(~~< ='
teacherAndClassRoomApiModel~~= X
.~~X Y
ClassRoomList~~Y f
)~~f g
;~~g h
obj
‰‰ 
.
‰‰ 
ClassRoomList
‰‰ 
=
‰‰ 
classRoomList
‰‰  -
;
‰‰- .
_context
ŠŠ 
.
ŠŠ 
Teachers
ŠŠ 
.
ŠŠ 
Add
ŠŠ !
(
ŠŠ! "
obj
ŠŠ" %
)
ŠŠ% &
;
ŠŠ& '
await
‹‹ 
_context
‹‹ 
.
‹‹ 
SaveChangesAsync
‹‹ +
(
‹‹+ ,
)
‹‹, -
;
‹‹- .
return
 
Ok
 
(
 
)
 
;
 
}
ŽŽ 	
[
‘‘ 	

HttpDelete
‘‘	 
(
‘‘ 
$str
‘‘ 
)
‘‘ 
]
‘‘ 
public
““ 
async
““ 
Task
““ 
<
““ 
IActionResult
““ '
>
““' (
DeleteTeachers
““) 7
(
““7 8
int
““8 ;
id
““< >
)
““> ?
{
”” 	
if
•• 
(
•• 
_context
•• 
.
•• 
Teachers
•• !
==
••" $
null
••% )
)
••) *
{
–– 
return
—— 
NotFound
—— 
(
——  
)
——  !
;
——! "
}
˜˜ 
var
™™ 
teachers
™™ 
=
™™ 
await
™™  
_context
™™! )
.
™™) *
Teachers
™™* 2
.
™™2 3
	FindAsync
™™3 <
(
™™< =
id
™™= ?
)
™™? @
;
™™@ A
if
šš 
(
šš 
teachers
šš 
==
šš 
null
šš  
)
šš  !
{
›› 
return
œœ 
NotFound
œœ 
(
œœ  
)
œœ  !
;
œœ! "
}
 
_context
ŸŸ 
.
ŸŸ 
Teachers
ŸŸ 
.
ŸŸ 
Remove
ŸŸ $
(
ŸŸ$ %
teachers
ŸŸ% -
)
ŸŸ- .
;
ŸŸ. /
await
   
_context
   
.
   
SaveChangesAsync
   +
(
  + ,
)
  , -
;
  - .
return
¢¢ 
	NoContent
¢¢ 
(
¢¢ 
)
¢¢ 
;
¢¢ 
}
££ 	
private
¤¤ 
bool
¤¤ 
TeacherExists
¤¤ "
(
¤¤" #
int
¤¤# &
id
¤¤' )
)
¤¤) *
{
¥¥ 	
return
¦¦ 
(
¦¦ 
_context
¦¦ 
.
¦¦ 
Teachers
¦¦ %
?
¦¦% &
.
¦¦& '
Any
¦¦' *
(
¦¦* +
e
¦¦+ ,
=>
¦¦- /
e
¦¦0 1
.
¦¦1 2
ID
¦¦2 4
==
¦¦5 7
id
¦¦8 :
)
¦¦: ;
)
¦¦; <
.
¦¦< =
GetValueOrDefault
¦¦= N
(
¦¦N O
)
¦¦O P
;
¦¦P Q
}
§§ 	
[
©©	 

	HttpPatch
©©
 
(
©© 
$str
©© 
)
©© 
]
©© 
[
«« 	
	HttpPatch
««	 
(
«« 
$str
««  
)
««  !
]
««! "
public
¬¬ 
async
¬¬ 
Task
¬¬ 
<
¬¬ 
IActionResult
¬¬ '
>
¬¬' (
PatchTeacher
¬¬) 5
(
¬¬5 6
int
¬¬6 9
	teacherId
¬¬: C
,
¬¬C D
TeacherApiModel
¬¬E T
teacherApiModel
¬¬U d
)
¬¬d e
{
­­ 	
if
®® 
(
®® 
_context
®® 
.
®® 
Teachers
®® !
==
®®" $
null
®®% )
)
®®) *
{
¯¯ 
return
°° 
	NoContent
°°  
(
°°  !
)
°°! "
;
°°" #
}
±± 
var
²² 
teacher
²² 
=
²² 
await
²² 
_context
²²  (
.
²²( )
Teachers
²²) 1
.
²²1 2
	FindAsync
²²2 ;
(
²²; <
	teacherId
²²< E
)
²²E F
;
²²F G
if
³³ 
(
³³ 
teacher
³³ 
==
³³ 
null
³³ 
)
³³  
{
´´ 
return
µµ 
NotFound
µµ 
(
µµ  
)
µµ  !
;
µµ! "
}
¶¶ 
teacher
·· 
.
·· 
Name
·· 
=
·· 
teacherApiModel
·· *
.
··* +
Name
··+ /
;
··/ 0
teacher
¸¸ 
.
¸¸ 
Address
¸¸ 
=
¸¸ 
teacherApiModel
¸¸ -
.
¸¸- .
Address
¸¸. 5
;
¸¸5 6
_context
¹¹ 
.
¹¹ 
Teachers
¹¹ 
.
¹¹ 
Update
¹¹ $
(
¹¹$ %
teacher
¹¹% ,
)
¹¹, -
;
¹¹- .
await
ºº 
_context
ºº 
.
ºº 
SaveChangesAsync
ºº +
(
ºº+ ,
)
ºº, -
;
ºº- .
return
»» 
Ok
»» 
(
»» 
)
»» 
;
»» 
}
¼¼ 	
}
½½ 
}¾¾ „
@D:\C#handson\WebAPI-2\MappingConfigurations\AutoMapperProfile.cs
	namespace 	
WebAPI_2
 
. !
MappingConfigurations (
{ 
public 

class 
AutoMapperProfile "
:# $
Profile% ,
{ 
public		 
AutoMapperProfile		  
(		  !
)		! "
{

 	
	CreateMap 
< 
Teacher 
, 
TeacherApiModel .
>. /
(/ 0
)0 1
.1 2

ReverseMap2 <
(< =
)= >
;> ?
	CreateMap 
< 
	ClassRoom 
,  
ClassRoomApiModel! 2
>2 3
(3 4
)4 5
.5 6

ReverseMap6 @
(@ A
)A B
;B C
} 	
} 
} È
 D:\C#handson\WebAPI-2\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddDbContext !
<! "
ApiDbContext" .
>. /
(/ 0
options0 7
=>8 :
options		 
.		 
UseSqlServer		 
(		 
builder		  
.		  !
Configuration		! .
.		. /
GetConnectionString		/ B
(		B C
$str		C Z
)		Z [
??		\ ^
throw

 	
new


 %
InvalidOperationException

 '
(

' (
$str

( ^
)

^ _
)

_ `
)

` a
;

a b
builder 
. 
Services 
. 
AddAutoMapper 
( 
typeof %
(% &
Program& -
)- .
). /
;/ 0
builder 
. 
Services 
. 
AddControllers 
(  
)  !
. 
AddJsonOptions 
( 
options 
=> 
options &
.& '!
JsonSerializerOptions' <
.< =
ReferenceHandler= M
=N O
ReferenceHandlerP `
.` a
IgnoreCyclesa m
)m n
;n o
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
builder 
. 
Services 
. 
AddSwaggerGen 
( 
)  
;  !
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
app 
. 
UseHttpsRedirection 
( 
) 
; 
app 
. 
UseAuthorization 
( 
) 
; 
app 
. 
MapControllers 
( 
) 
; 
if   
(   
app   
.   
Environment   
.   
IsDevelopment    
(    !
)  ! "
)  " #
{!! 
app"" 
."" 

UseSwagger"" 
("" 
)"" 
;"" 
app## 
.## 
UseSwaggerUI## 
(## 
)## 
;## 
}$$ 
app&& 
.&& 
Run&& 
(&& 
)&& 	
;&&	 
¹
(D:\C#handson\WebAPI-2\WeatherForecast.cs
	namespace 	
WebAPI_2
 
{ 
public 

class 
WeatherForecast  
{ 
public 
DateTime 
Date 
{ 
get "
;" #
set$ '
;' (
}) *
public 
int 
TemperatureC 
{  !
get" %
;% &
set' *
;* +
}, -
public		 
int		 
TemperatureF		 
=>		  "
$num		# %
+		& '
(		( )
int		) ,
)		, -
(		- .
TemperatureC		. :
/		; <
$num		= C
)		C D
;		D E
public 
string 
? 
Summary 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} 